var express = require('express');
var bodyparser = require('body-parser');
var path = require('path');
var morgan = require('morgan');
var env = require('node-env-file');
var jwt = require('jsonwebtoken');
var cookieParser = require('cookie-parser');
var passport = require('passport');

// var db = require('./db/db.js');
// var User = require('./db/controllers/user.js');
// var assignTokenSignin = require('./routers/assignTokenSignin.js');
// var verifyToken = require('./routers/verifyToken');

var port = process.env.PORT || 3000;

var app = express();

//CORS
app.use(function (req, res, next) {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
  next();
});
/*
 *Global Middlewares
 */
app.use(morgan('combined'));
app.use(bodyparser.urlencoded({ extended: false }));
app.use(bodyparser.json());
app.use(passport.initialize());
app.use(passport.session());
app.use(cookieParser());
/*DESKTOP VERSION
app.use(express.static(__dirname + '/../client/'));
*/
app.use(express.static(__dirname + '/../www/'));
/*
 *Subrouters
 */

//Every request with the beginning endpoint of its assigned URL
//gets ran through the subrouter first
// app.use('/api', verifyToken);
//NOTE: this takes care of passport and our signin/signup
// app.use('/auth', assignTokenSignin);

// using x,y Google Maps coordinates, find and return all the permit zones for that area
app.get('/zones/:xCoord/:yCoord', function (req, res) {
  console.log('received request for', req.params.xCoord, req.params.yCoord);
  res.status(200).send({"index":0,"parkingCode":"R-1H","coordinates":[[[-122.2735557200153,37.90459608249529],[-122.27352403856848,37.9045759527411],[-122.27340839945083,37.904524127849164],[-122.27331375111423,37.90448023173044],[-122.27323842840102,37.9044470202025],[-122.27309292267253,37.90437848323214],[-122.2729264455747,37.90430269862301],[-122.27287014524555,37.904267827931406],[-122.27284006927331,37.90424219203694],[-122.27279388220128,37.90419549626818],[-122.2727510820871,37.90414532937339],[-122.27271853061053,37.90408882169845],[-122.27269437221516,37.904020514858864],[-122.27266825394135,37.90394331372129],[-122.27265600940957,37.90386589818502],[-122.27264575048387,37.90379944960759],[-122.27264378698354,37.903717076533624],[-122.27266941306361,37.903556690475696],[-122.2726866204221,37.90347883639805],[-122.27271442917775,37.90340974749651],[-122.27274894669569,37.903330949918846],[-122.27278888824584,37.90326168044914],[-122.27284772640317,37.90318525567683],[-122.27289731121435,37.90308425645312],[-122.27311097028996,37.9031037055475],[-122.27330188477471,37.90311458183768],[-122.27346845125737,37.90312169381658],[-122.27363348289495,37.90313706584617],[-122.27380707878746,37.90314819540234],[-122.27391803463381,37.903149273346045],[-122.2740091989901,37.90312043121074],[-122.27413302677225,37.90307943650715],[-122.27425510372231,37.903038455211444],[-122.27437881306716,37.90299333477731],[-122.27457999256565,37.90292576431969],[-122.27482243882721,37.90284452830028],[-122.27486878189268,37.9028252973519],[-122.27489141858229,37.90282976028476],[-122.27490901701603,37.90284116408124],[-122.27493393467137,37.90286825615252],[-122.27500711520895,37.90295642966204],[-122.27508525882473,37.903034907904875],[-122.27514390910565,37.90309583019885],[-122.27515664767724,37.90312104644528],[-122.27516634425791,37.903164162443936],[-122.2751638203293,37.90320334612617],[-122.2751370168763,37.903242201828256],[-122.27512014071324,37.90326099382641],[-122.27509447052674,37.90327511211392],[-122.27505333867428,37.903294273851564],[-122.27482479057672,37.90337736023565],[-122.27468042135835,37.90342828744276],[-122.27447413701535,37.903500056784104],[-122.27430582381388,37.90356438227225],[-122.27411133563362,37.90362224339195],[-122.27402874362316,37.90364752071079],[-122.27390807021868,37.903674736955416],[-122.27378378166219,37.903695834916256],[-122.27365761357825,37.90371077662344],[-122.27362653244654,37.90371605201814],[-122.27360178302325,37.9036958190553],[-122.27356156154072,37.90368062928181],[-122.27350588015547,37.90367184955842],[-122.27345394392968,37.90367469654495],[-122.27340917255248,37.90368704178788],[-122.2733682491703,37.90371512695924],[-122.27334158516759,37.90375946653453],[-122.27333929683871,37.903808945221186],[-122.2733450003929,37.90383014760596],[-122.27337533336798,37.90386608666821],[-122.2734158907758,37.90389501148618],[-122.27346306804458,37.90391077961082],[-122.27352033437754,37.90391403703917],[-122.27357893670316,37.90390011018841],[-122.27360459715624,37.903885992174914],[-122.27364020775384,37.903853181585404],[-122.27375770542106,37.90383768348112],[-122.27378710598622,37.90383518401109],[-122.27391321422544,37.90381749602658],[-122.27404770496008,37.903788008588045],[-122.27412507852145,37.90376144177875],[-122.27415968044066,37.903758856675246],[-122.27417716743503,37.90376546189189],[-122.27418967258062,37.903781068631105],[-122.27418167247863,37.90380865140048],[-122.27416505821962,37.90391121723397],[-122.27417431002014,37.904007903504514],[-122.27419278482681,37.904055693254115],[-122.27422912909644,37.90412587976119],[-122.27425951243411,37.90416456467684],[-122.27429140826901,37.90419361829589],[-122.2743215738779,37.904222685573195],[-122.27440973689242,37.904285891080846],[-122.27432571495284,37.90437591859577],[-122.27382466766656,37.90486482811099],[-122.27374861988922,37.90476210430409],[-122.27370237693029,37.904712670889076],[-122.27365635689391,37.904672851054286],[-122.2735557200153,37.90459608249529]]]})
  // ParkingDB.findPermitZones([req.params.xCoord, req.params.yCoord]).then(function (data) {
  //   res.status(200).send(data);
  // });
});

// Add new parking zones from the front end when a post request to /zones is made
// this should be an an admin only feature
// app.post('/zones', function (req, res) {
//   ParkingDB.savePermitZones(req.body).then(function (data) {  //function is in parking.js)
//     res.status(201).send(data);
//   });
// });

app.post('/photo', function (req, res, next) {
  res.status(200).send(req.body);
})

app.listen(port);
console.log('server listening on port, :', port);
